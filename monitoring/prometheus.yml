global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'django'
    static_configs:
      - targets: ['backend:8000']
    metric_relabel_configs:
      # Docker Compose 서비스 라벨을 container_name으로 변환
      - source_labels: [container_label_com_docker_compose_service]
        regex: "(.*)"
        target_label: container_name
        replacement: "${1}"

  - job_name: 'cadvisor-api'
    static_configs:
      - targets: ['cadvisor-api:8080']
    metric_relabel_configs:
      # Docker Compose 서비스 라벨을 container_name으로 변환
      - source_labels: [container_label_com_docker_compose_service]
        regex: "(.*)"
        target_label: container_name
        replacement: "${1}"
      # name 라벨도 container_name으로 변환 (fallback)
      - source_labels: [name]
        regex: "^/(.*)"
        target_label: container_name
        replacement: "${1}"

  - job_name: 'cadvisor-worker'
    static_configs:
      - targets: ['172.31.51.114:8081']
    metric_relabel_configs:
      # Docker Compose 서비스 라벨을 container_name으로 변환
      - source_labels: [container_label_com_docker_compose_service]
        regex: "(.*)"
        target_label: container_name
        replacement: "${1}"
      # name 라벨도 container_name으로 변환 (fallback)
      - source_labels: [name]
        regex: "^/(.*)"
        target_label: container_name
        replacement: "${1}"

  # celery-exporter는 ARM64 호환 이슈로 비활성화
  # - job_name: 'celery-exporter'
  #   static_configs:
  #     - targets: ['${WORKER_SERVER_IP}:9808']